# Firebase App Hosting configuration
runConfig:
  # Use CI build script with TypeScript bypass
  buildCommand: npm run build:ci
  
  # Node.js runtime configuration
  runtime: nodejs20
  
  # Environment variables for the build
  env:
    - variable: NODE_ENV
      value: production
    - variable: NEXT_PUBLIC_DEPLOY_TARGET
      value: app-hosting
    - variable: NEXT_PUBLIC_STATIC_EXPORT
      value: "false"
    - variable: CI
      value: "true"
    - variable: IGNORE_TS_ERRORS
      value: "true"
    - variable: IGNORE_ESLINT_ERRORS
      value: "true"
  
  # Memory and CPU allocation for build
  cpu: 4
  memory: 8GiB
  
  # Timeout for build process (20 minutes)
  timeoutSeconds: 1200

# Static asset serving configuration
serveConfig:
  # Serve the Next.js standalone build
  buildOutputDirectory: .next
  
  # Headers for static assets
  headers:
    - source: "/_next/static/**"
      headers:
        - key: "Cache-Control"
          value: "public, max-age=31536000, immutable"
    
    - source: "/sw.js"
      headers:
        - key: "Cache-Control"
          value: "public, max-age=0, must-revalidate"
    
    - source: "/**/*.js"
      headers:
        - key: "Cache-Control"
          value: "public, max-age=31536000, immutable"
    
    - source: "/**/*.css"
      headers:
        - key: "Cache-Control"
          value: "public, max-age=31536000, immutable"
  
  # Redirects and rewrites
  rewrites:
    - source: "**"
      destination: "/index.html"
  
  # Clean URLs (remove .html extension)
  cleanUrls: true
  
  # Trailing slash behavior
  trailingSlash: false